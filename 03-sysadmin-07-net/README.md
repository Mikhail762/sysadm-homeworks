# Домашнее задание к занятию "3.7. Компьютерные сети, лекция 2"

1. На лекции мы обсудили, что манипулировать размером окна необходимо для эффективного наполнения приемного буфера участников TCP сессии (Flow Control). Подобная проблема в полной мере возникает в сетях с высоким RTT. Например, если вы захотите передать 500 Гб бэкап из региона Юга-Восточной Азии на Восточное побережье США. [Здесь](https://www.cloudping.co/grid) вы можете увидеть и 200 и 400 мс вполне реального RTT. Подсчитайте, какого размера нужно окно TCP чтобы наполнить 1 Гбит/с канал при 300 мс RTT (берем простую ситуацию без потери пакетов). Можно воспользоваться готовым [калькулятором](https://www.switch.ch/network/tools/tcp_throughput/). Ознакомиться с [формулами](https://en.wikipedia.org/wiki/TCP_tuning), по которым работает калькулятор можно, например, на Wiki.  

В отсутствии потерь пропускная способность равна: T = W/RTT, откуда W - размер окна, соответственно, равно: W = 1Гбит/с * 300мс = 1 000 000 000 * 0,3 = 300 000 000 бит. Переведем в байты: 300 000 000 /8 = 37 500 000 байт = 37,5 Мб.  
  
1. Во сколько раз упадет пропускная способность канала, если будет 1% потерь пакетов при передаче?

 Я попробовал измерить практически, с помощью программы iperf, запущенной на 2 виртуальных машинах.
Сначала контрольное измерение, без потерь:
```
vagrant@vagrant:~$ iperf3 -c 192.168.10.86 -t 30
[ ID] Interval           Transfer     Bitrate         Retr
...
[  5]   0.00-30.00  sec   335 MBytes  93.6 Mbits/sec    0  
```
Traffic Control, программа управления сетевым трафиком. Эмулирую потерю 1% пакетов на eth0:  
```
vagrant@vagrant:~$ sudo tc qdisc add dev eth0 root netem loss 1%
vagrant@vagrant:~$ iperf3 -c 192.168.10.86 -t 30
...
[ ID] Interval           Transfer     Bitrate         Retr
[  5]   0.00-30.00  sec   295 MBytes  82.5 Mbits/sec  2349 
```
Получается снижение bitrate  в 93.6/82.5 = 1.13 раз.  


1. Какая  максимальная реальная скорость передачи данных достижима при линке 100 Мбит/с? Вопрос про TCP payload, то есть цифры, которые вы реально увидите в операционной системе в тестах или в браузере при скачивании файлов. Повлияет ли размер фрейма на это?

В отсутствии потерь пакетов и минимизации сервисной информации TCP скорость скачивания будет чуть меньше пропускной способности, и равна отношению (MTU - заголовки TCP и IP) к (MTU + заголовки Ethernet + межкадровый интервал(IFG)).  
Max TCP Payload= (MTU–TCP–IP) / (MTU+Ethernet+IFG) = (1500–40) / (1500+26+12) = 94.9 %  
100 000 000 * 0.949 = 94 900 000 бит/с = 11 862 500 байт/с = 11,86 Мбайт/сек  
Это справедливо для стандартных Ethernet устройств. Возможно использование фреймов большего размера (Giants, Jumbo), однако это требует поддержки всех устройств на линии, поэтому имеет смысл использовать только между парой устройств на специальных высокоскоростных линиях связи.


1. Что на самом деле происходит, когда вы открываете сайт? :)
На прошлой лекции был приведен сокращенный вариант ответа на этот вопрос. Теперь вы знаете намного больше, в частности про IP адресацию, DNS и т.д.
Опишите максимально подробно насколько вы это можете сделать, что происходит, когда вы делаете запрос `curl -I http://netology.ru` с вашей рабочей станции. Предположим, что arp кеш очищен, в локальном DNS нет закешированных записей.

1. Сколько и каких итеративных запросов будет сделано при резолве домена `www.google.co.uk`?

1. Сколько доступно для назначения хостам адресов в подсети `/25`? А в подсети с маской `255.248.0.0`. Постарайтесь потренироваться в ручных вычислениях чтобы немного набить руку, не пользоваться калькулятором сразу.

1. В какой подсети больше адресов, в `/23` или `/24`?

1. Получится ли разделить диапазон `10.0.0.0/8` на 128 подсетей по 131070 адресов в каждой? Какая маска будет у таких подсетей?


 
 ---

### Как оформить ДЗ?

Домашнее задание выполните в файле readme.md в github репозитории. В личном кабинете отправьте на проверку ссылку на .md-файл в вашем репозитории.

Также вы можете выполнить задание в [Google Docs](https://docs.google.com/document/u/0/?tgif=d) и отправить в личном кабинете на проверку ссылку на ваш документ.
Название файла Google Docs должно содержать номер лекции и фамилию студента. Пример названия: "1.1. Введение в DevOps — Сусанна Алиева"
Перед тем как выслать ссылку, убедитесь, что ее содержимое не является приватным (открыто на комментирование всем, у кого есть ссылка). 
Если необходимо прикрепить дополнительные ссылки, просто добавьте их в свой Google Docs.

Любые вопросы по решению задач задавайте в чате Slack.

---
